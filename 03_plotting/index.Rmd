---
title: "使用R进行数据可视化"
subtitle: "03 — 用ggplot2绘图"
author: "孙方"
# institute: "RStudio, PBC"
# date: "2016/12/12 (updated: `r Sys.Date()`)"
output:
  xaringan::moon_reader:
    lib_dir: libs
    css:
      - default
      - ../ipa-fonts.css
      - ../custom.css
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      beforeInit: "../macros.js"
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
library(tidyverse)
theme_set(theme_minimal(base_size = 16))
library()
library(intRo)
library(ggrepel)
data("social")
data("endangered")
data("harry_potter")
data("df_ratios")
df_ratios <- drop_na(df_ratios, student_ratio)
data("fly")
fly <- drop_na(fly)
```

```{r xaringanExtra, echo=FALSE}
xaringanExtra::use_xaringan_extra(c("panelset", "tachyons"))
```

# Visualise data

![](../img/data-viz.png)
---

# 图形系统

- 基础 R。

- lattice。

- ggplot2。

- 更多...

---

# 基础 R 绘图函数

```{r scatter, eval=FALSE}
x <- 1:10
y <- x^3

plot(x, y)
```

---

# 基础 R 绘图函数


```{r scatter-plot, echo=FALSE}
x <- 1:10
y <- x^3

plot(x, y)
```

---

# 基础 R 绘图函数

```{r line, eval=FALSE}
x <- seq(1, 10, by = 0.01)
y <- x^3

plot(x, y, type = "l", col = "purple", lwd = 3, lty = "dashed")
```

---

# 基础 R 绘图函数

```{r line-plot, echo=FALSE}
x <- seq(1, 10, by = 0.01)
y <- x^3

plot(x, y, type = "l", col = "purple", lwd = 3, lty = "dashed")
```

---

# 包来救援

<br>

- R **库**包含已安装的包。

  - 基础 R。

  - 额外的包。

- 使用 `install.packages()` 安装额外的包。

--

.bg-washed-blue.b--dark-blue.ba.bw2.br3.shadow-5.ph4.mt5[

在控制台中运行此命令：

```r
install.packages("fortunes")
```

]

---

# 包来救援

要使用库中安装的包，你可以通过 `library()` 来加载包。

--

.bg-washed-blue.b--dark-blue.ba.bw2.br3.shadow-5.ph4.mt5[

在控制台中运行此命令：

```{r fortunes}
library(fortunes)
```

]

---

# 包来救援

现在你可以使用附加包提供的函数

--

.bg-washed-blue.b--dark-blue.ba.bw2.br3.shadow-5.ph4.mt5[

在控制台中运行此命令：

```{r fortune}
fortune()
```

]

---

# 你的睡眠像长颈鹿还是棕色蝙蝠？

```{r msleep, eval=FALSE}
ggplot(
  data = msleep,
  mapping = aes(x = sleep_total, y = sleep_rem)
) +
  geom_point()
```

---

# 你的睡眠像长颈鹿还是棕色蝙蝠？

```{r msleep-plot, fig.align='center', echo=FALSE, message=FALSE, warning=FALSE, out.height="500px", dpi=300}
ggplot(
  data = msleep,
  mapping = aes(x = sleep_total, y = sleep_rem)
) +
  geom_point()
```

---

# 你的睡眠像长颈鹿还是棕色蝙蝠？


```{r msleep-lab, eval=FALSE}
library(ggrepel)

ggplot(
  data = msleep,
  mapping = aes(x = sleep_total, y = sleep_rem, label = name)
) +
  geom_point() +
  geom_label_repel()
```

---

# 你的睡眠像长颈鹿还是棕色蝙蝠？


```{r msleep-lab-plot, fig.align='center', echo=FALSE, message=FALSE, warning=FALSE, out.height="500px", dpi=300}
ggplot(
  data = msleep,
  mapping = aes(x = sleep_total, y = sleep_rem, label = name)
) +
  geom_point() +
  geom_label_repel()
```

---

# 2008-2019年社交媒体用户

```{r social, eval=FALSE}
social %>%
  filter(platform %in% c(
    "Facebook", "Twitter", "TikTok", "Instagram", "YouTube"
    )
  ) %>%
  ggplot(aes(year, users, colour = platform)) +
  geom_line() +
  geom_point()
```

---

# 2008-2019年社交媒体用户

```{r social-plot, fig.align='center', echo=FALSE, message=FALSE, warning=FALSE, out.height="500px", dpi=300}
social %>%
  filter(platform %in% c("Facebook", "Twitter", "TikTok", "Instagram", "YouTube")) %>%
  ggplot(aes(year, users, colour = platform)) +
  geom_line() +
  geom_point()
```

---

# 语言濒危

```{r endanger, eval=FALSE}
endangered %>%
  ggplot(aes(status, fill = status)) +
  geom_bar() +
  scale_fill_brewer(palette = "Reds")
```

---

# 语言濒危

```{r endanger-plot, echo=FALSE, fig.align='center', out.height="500px", dpi=300}
endangered %>%
  ggplot(aes(status, fill = status)) +
  geom_bar() +
  scale_fill_brewer(palette = "Reds") +
  theme(legend.position = "none")
```

---

# 霍格沃茨学院与占星元素

```{r hp, eval=FALSE}
harry_potter %>%
  ggplot(aes(element, fill = house)) +
  geom_bar(position = "dodge") +
  scale_fill_manual(
    values = c("#76040a", "#f29e02", "#0121a2", "#1d492c")
  )
```

---

# 霍格沃茨学院与占星元素

```{r hp-plot, echo=FALSE, fig.align='center', out.height="500px", dpi=300}
harry_potter %>%
  ggplot(aes(element, fill = house)) +
  geom_bar(position = "dodge") +
  scale_fill_manual(values = c("#76040a", "#f29e02", "#0121a2", "#1d492c")) +
  theme(legend.position = "top")
```

---

# 学生/教师比例

```{r st-ratio, eval=FALSE}
df_ratios %>%
  mutate(
    region = fct_reorder(region, -student_ratio_region)
  ) %>%
  ggplot(
    aes(x = region, y = student_ratio, color = region)
  ) +
  geom_jitter(size = 4, alpha = 0.6, width = 0.2) +
  coord_flip() +
  labs(
    y = "Student to teacher ratio",
    x = element_blank()
  ) +
  theme(legend.position = "none")
```

---

# 学生/教师比例

```{r st-ratio-plot, echo=FALSE, fig.align='center', out.height="500px", dpi=300}
df_ratios %>%
  mutate(
    region = fct_reorder(region, -student_ratio_region)
  ) %>%
  ggplot(
    aes(x = region, y = student_ratio, color = region)
  ) +
  geom_jitter(size = 4, alpha = 0.6, width = 0.2) +
  coord_flip() +
  labs(
    y = "Student to teacher ratio",
    x = element_blank()
  ) +
  theme(legend.position = "none")
```

---

# 你会拒绝邀请吗？

```{r decline, eval=FALSE}
ggplot(data = fly) +
  geom_mosaic(aes(x = product(rude_to_recline), fill = do_you_recline)) +
  labs(x = "Is it rude to decline?", y = "Do you decline?") +
  theme_mosaic() +
  theme(legend.position = "none")
```

---

# 你会拒绝邀请吗？


```{r decline-plot, echo=FALSE, fig.align='center', out.height="500px", dpi=300}
ggplot(data = fly) +
  geom_mosaic(aes(x = product(rude_to_recline), fill = do_you_recline)) +
  labs(x = "Is it rude to decline?", y = "Do you decline?") +
  theme_mosaic() +
  theme(legend.position = "none")
```

---

class: middle center inverse

.f1[TUTORIAL]
